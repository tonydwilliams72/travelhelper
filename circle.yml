machine:
  services:
    - docker

test:
  post:
    - docker build  -t travel-helper:latest .
    - docker run -d -p 5000:5000 travel-helper:latest ; sleep 10
    - curl --fail --retry 10 --retry-delay 5 localhost:5000/sw

deployment:
  prod:
    branch: master
    commands:
      - $(aws ecr get-login --region eu-west-1)
      - docker tag travel-helper:latest 145949126156.dkr.ecr.eu-west-1.amazonaws.com/travel-helper:$CIRCLE_SHA1
      - docker push 145949126156.dkr.ecr.eu-west-1.amazonaws.com/travel-helper:latest
      - ./deploy.sh $CIRCLE_SHA1
